#!/bin/bash

# c-basic-offset: 4; tab-width: 4; indent-tabs-mode: t
# vi: set shiftwidth=4 tabstop=4 noexpandtab:
# :indentSize=4:tabSize=4:noTabs=false:

set -o nounset
set -o errexit
set -o pipefail

# shellcheck disable=SC1090
source "$HOME/bin/common.bash"

###############################################################################
set -x

# starship
starship -V
bash <(curl -fsSL https://starship.rs/install.sh) --verbose --bin-dir $HOME/bin2 --yes
starship -V

# kubie
kubie update

# kubetail
curl https://raw.githubusercontent.com/johanhaleby/kubetail/master/kubetail > $HOME/bin/kubetail ; chmod +x $HOME/bin/kubetail
curl https://raw.githubusercontent.com/johanhaleby/kubetail/master/completion/kubetail.bash > $HOME/.bashrc.d/completions.kubetail.bash

# lazykube
curl https://raw.githubusercontent.com/TNK-Studio/lazykube/main/scripts/install_update_linux.sh | sed s/sudo//g | DIR=$HOME/bin2/  bash -x

# flux
flux -v
curl -s https://fluxcd.io/install.sh | bash -s ~/bin
flux -v

#vcluster
vcluster upgrade

#kdash
curl https://raw.githubusercontent.com/kdash-rs/kdash/main/deployment/getLatest.sh | sed s@/usr/local/bin@/home/serge/bin2@ | bash -x

# havener
curl -sL https://raw.githubusercontent.com/homeport/havener/main/scripts/download-latest.sh | sed 's@${HOME}/bin@${HOME}/bin2@' | bash -x

#kubescape
curl -s https://raw.githubusercontent.com/armosec/kubescape/master/install.sh | sed s@/usr/local/bin@$HOME/bin2@ | bash -x

#kubecm https://kubecm.cloud/#/
VERSION=$(curl -s https://api.github.com/repos/sunny0826/kubecm/releases/latest | jq -r .tag_name)
NAME=$(curl -s https://api.github.com/repos/sunny0826/kubecm/releases/latest | jq -r .name)
curl -L https://github.com/sunny0826/kubecm/releases/download/${VERSION}/${NAME}_Linux_x86_64.tar.gz | tar -zxvf - kubecm && mv kubecm $HOME/bin2


# update completions
$HOME/.bashrc.d/generate_completions_from_binaries.sh

