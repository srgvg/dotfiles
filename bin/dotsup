#!/usr/bin/env bash

# c-basic-offset: 4; tab-width: 4; indent-tabs-mode: t
# vi: set shiftwidth=4 tabstop=4 noexpandtab:
# :indentSize=4:tabSize=4:noTabs=false:

set -o nounset
set -o errexit
set -o pipefail

# shellcheck disable=SC1090
source "$HOME/bin/common.bash"

###############################################################################

cd $HOME

if [ -z "${1:-}" ]
then
	echo "--------------------------------"
	echo "Update ..."
	echo "--------------------------------"
	vcsh foreach remote update --prune
	echo "--------------------------------"
	echo "Pull ..."
	echo "--------------------------------"
	vcsh foreach pull
	echo "--------------------------------"
	echo "Info ..."
	echo "--------------------------------"
	vcsh foreach status --short --branch --verbose --show-stash
elif [ "${1:-}" = "add" ]
then
	echo "--------------------------------"
	echo "Adding ..."
	echo "--------------------------------"
	vcsh foreach add --all
	$HOME/bin/dotsadd
	echo "--------------------------------"
	echo "Info ..."
	echo "--------------------------------"
	vcsh foreach status --short --branch --verbose --show-stash
elif [ "${1:-}" = "commit" ]
then
	echo "--------------------------------"
	echo "Committing ..."
	echo "--------------------------------"
	vcsh foreach commit -m "update from $HOSTNAME"
	echo "--------------------------------"
	echo "Pushing ..."
	echo "--------------------------------"
	vcsh foreach pushall
	echo "--------------------------------"
	echo "Info ..."
	echo "--------------------------------"
	vcsh foreach status --short --branch --verbose --show-stash
fi
