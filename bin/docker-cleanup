#!/bin/bash

# c-basic-offset: 4; tab-width: 4; indent-tabs-mode: t
# vi: set shiftwidth=4 tabstop=4 expandtab:
# :indentSize=4:tabSize=4:noTabs=false:

set -o nounset
set -o errexit
set -o pipefail


# shellcheck disable=SC1090
source "$HOME/bin/common.bash"

# Remove exited containers
containers=$(docker ps -a -q -f status=exited)
if [ -n "${containers}" ]; then
    docker rm -v ${containers}
fi

# Remove dangling images
dangling=$(docker images -f "dangling=true" -q)
if [ -n "${dangling}" ]; then
    docker rmi ${dangling}
fi

# Remove dangling volumes
volumes=$(docker volume ls -qf dangling=true)
if [ -n "${volumes}" ]; then
    docker volume rm ${volumes}
fi

# NOTE: Removed dangerous "docker images -q | xargs docker rmi" which deleted ALL images
